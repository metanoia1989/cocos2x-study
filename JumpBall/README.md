# 2D 物理系统初探 

Cocos Creator 支持内置的轻量 Builtin 物理系统和强大的 Box2D 物理系统。Builtin 物理系统只提供了碰撞检测的功能，对于物理计算较为简单的情况，推荐使用 Builtin 物理模块，这样可以避免加载庞大的Box2D物理模块并减小构建和运行物理世界的开销。而Box2D物理模块提供了更完善的交互接口和刚体、关节等预设好的组件。

简单的碰撞使用 Builtin 物理系统即可，因为跳跃小球用到小球碰撞和弹跳，所以要用【基于 Box2D 的 2D 物理系统】。 

刚体是组成物理世界的基本对象，物理引擎会通过刚体上的相关属性，例如质移动速度、旋转速度等，来计算并模拟对应的物理行为。

组件添加完RagidBody2D属性后，当我们尝试预览运行时会发现，在游戏场景加载完成后，小球会直接往下掉落。在现实世界中，如果从高处抛下一个实心球，由于受重力影响，实心球将会往下掉落。而在物理引擎中也是类似的，当向小球对象添加了刚体组件后，它将会变成物理引擎世界中的一个物体，并会受到其中的重力的影响从而往下掉落。

Cocos Creator 提供了四种类型的 2D 刚体组件。 

* Static 静态刚体，零质量，零速度，不会受到重力的影响，可以设置它的位置来进行移动
* Dynamic 动态刚体，有质量，可以设置速度，会受到重力的影响
* Kinematic 运动刚体，零质量，可以设置速度，不会受到重力的影响，可以设置它的位置来进行移动
* Animated  Kinematic衍生的类型，会根据当前与目标的旋转或位移属性，计算出所需的速度，并且赋值到对应的移动或旋转速度上，主要与动画编辑结合使用


在Cocos Creator中，2D物理对象可以添加一个或多个碰撞组件，每个碰撞组件都会包含一个碰撞区域，这些碰撞区域定义了对象的碰撞边界。通过这些区域可以检测对象之间是否发生了接触。也正是这些碰撞区域让物理引擎“看到”了刚体。


2D碰撞组件都继承自 Collider2D 类，并能对以下事件注册监听。  

* Contact2DType.BEGIN_CONTACT 只在两个碰撞体开始接触时被调用一次
* Contact2DType.END_CONTACT 只在两个碰撞体结束接触时被调用一次
* Contact2DType.PRE_SOLVE 在每次处理碰撞体接触逻辑之前被调用
* Contact2DType.POST_SOLVE 在每次处理完碰撞体接触逻辑时被调用



# Prefab 预制体 

根据游戏规则，游戏开始后场景会向玩家提供多块可以踩踏的跳板，为了实现这一需求，我们可以在编辑场景时，通过复制的方式向场景中添加多块跳板。不过，采用这种方式添加的跳板会存在一个问题，即添加的跳板数量是有限的，当玩家控制小球前进足够远的距离后，将会出现跳板用完的情况。所以，我们希望在游戏运行的过程中，当发现跳板用完时，可以动态地添加。而想要动态地添加跳板，就需要一个新的概念“预制体”。

预制体（Prefab）是用于存储可复用场景对象的序列化文件，它可以包含节点、组件及组件上的数据。通俗地说，我们可以将预制体理解为专门用于复制的模板文件。这读起来似乎有些拗口，回想一下，我们在搭建场景的过程中，在复制某个对象前需要先制作一个可以用于复制的“原件”，之后才能在编辑器中基于“原件”进行相关的复制操作，而当我们将这个“原件”保存为序列化文件时，就可以将对应的文件称为预制体了。

此后，不论是在场景中还是脚本中，都可以使用同样的预制体进行复制。虽然直接使用对象进行复制与通过预制体进行复制，从结果上来说是相似的，但是通过使用预制体的方式，可以更加高效地组织和管理需要复制的对象模板。预制体的制作方法十分简单，在场景中将节点编辑好之后，将其从层级管理器中拖动到资源管理器中，即可完成预制体资源的创建。将层级管理器中的【block】节点拖动到【prefabs】文件夹中，此时文件夹中会自动生成一个以【block】节点为范本的预制体。 


# 遮罩

遮罩（Mask）用于规定子节点可以渲染的范围。默认带有Mask组件的节点会使用该节点的约束框（也就是属性检查器中Node组件的ContentSize 规定的范围）创建一个矩形渲染遮罩，该节点的所有子节点都会依据这个遮罩进行裁剪，遮罩范围外的部分将不会被渲染。我们可以将遮罩组件整体地想象成一块“黑布”，当它“盖在”节点上时，组件下的子节点的显示区域会被遮罩组件“挡住”，玩家只能透过“挖空”的部分看到里面的内容，即遮罩的剪裁区域，不同形状的遮罩区域（白色部分）。

Mask 组件的基础属性： 
* Type    遮罩类型。包括RECT, ELLIPSE, GRAPHICS_STENCIL, IMAGE_STENCIL 四种类型
* Segments    椭圆遮罩的曲线细分数，只在遮罩类型为 ELLIPSE 时生效
* Inverted    反向遮罩
* SpriteFrame 图片遮罩所使用的图片，只在遮罩类型为 IMAGE_STENCIL 时生效